version: 1
datasets:
# ---- INSTRUMENT DOMAIN (discovery endpoints - run first) ----
- domain: instrument
  source: fmp
  dataset: stock-list
  discriminator: ''
  ticker_scope: global
  silver_schema: silver
  silver_table: fmp_stock_list
  key_cols:
    - symbol
  row_date_col: null
  instrument_behavior: create
  instrument_type: equity
  recipes:
    - plans:
        - basic
      data_source_path: fake/stock-list
      query_vars: {}
      date_key: null
      cadence_mode: interval
      min_age_days: 0
      run_days:
        - mon
      execution_phase: instrument_discovery
      help_url: https://example.com/docs/stock-list
  dto_schema:
    dto_type: sbfoundation.dtos.instrument.stock_list_dto.StockListDTO
    columns:
      - name: symbol
        type: str
        nullable: false
      - name: name
        type: str
        nullable: true
      - name: price
        type: float
        nullable: true
      - name: exchange
        type: str
        nullable: true
      - name: exchange_short_name
        type: str
        nullable: true
      - name: type
        type: str
        nullable: true
      - name: ticker
        type: str
        nullable: true

- domain: instrument
  source: fmp
  dataset: etf-list
  discriminator: ''
  ticker_scope: global
  silver_schema: silver
  silver_table: fmp_etf_list
  key_cols:
    - symbol
  row_date_col: null
  instrument_behavior: create
  instrument_type: etf
  recipes:
    - plans:
        - basic
      data_source_path: fake/etf-list
      query_vars: {}
      date_key: null
      cadence_mode: interval
      min_age_days: 0
      run_days:
        - mon
      execution_phase: instrument_discovery
      help_url: https://example.com/docs/etf-list
  dto_schema:
    dto_type: sbfoundation.dtos.instrument.etf_list_dto.ETFListDTO
    columns:
      - name: symbol
        type: str
        nullable: false
      - name: name
        type: str
        nullable: true
      - name: price
        type: float
        nullable: true
      - name: exchange
        type: str
        nullable: true
      - name: exchange_short_name
        type: str
        nullable: true
      - name: ticker
        type: str
        nullable: true

# ---- COMPANY DOMAIN ----
- domain: company
  source: fmp
  dataset: company-profile
  discriminator: ''
  ticker_scope: per_ticker
  silver_schema: silver
  silver_table: company-profile
  key_cols:
    - ticker
  row_date_col: null
  recipes:
    - plans:
        - basic
      data_source_path: fake/profile
      query_vars:
        symbol: __ticker__
      date_key: null
      cadence_mode: interval
      min_age_days: 0
      run_days:
        - mon
      help_url: https://example.com/docs/profile
- domain: company
  source: fmp
  dataset: company-market-cap
  discriminator: ''
  ticker_scope: per_ticker
  silver_schema: silver
  silver_table: company-market-cap
  key_cols:
    - ticker
    - date
  row_date_col: date
  recipes:
    - plans:
        - basic
      data_source_path: fake/company-market-cap
      query_vars:
        symbol: __ticker__
      date_key: date
      cadence_mode: interval
      min_age_days: 0
      run_days:
        - mon
      help_url: https://example.com/docs/company-market-cap
- domain: economics
  source: fmp
  dataset: economic-indicators
  discriminator: ''
  ticker_scope: global
  silver_schema: silver
  silver_table: economic-indicators
  key_cols:
    - date
  row_date_col: date
  recipes:
    - plans:
        - basic
      data_source_path: fake/economic-indicators
      query_vars:
        name: test-indicator
        from: __from__
        to: __to__
      date_key: date
      cadence_mode: interval
      min_age_days: 0
      run_days:
        - mon
      help_url: https://example.com/docs/economic-indicators
- domain: fundamentals
  source: fmp
  dataset: income-statement
  discriminator: FY
  ticker_scope: per_ticker
  silver_schema: silver
  silver_table: income-statement
  key_cols:
    - ticker
    - date
  row_date_col: date
  recipes:
    - plans:
        - basic
      data_source_path: fake/income-statement
      query_vars:
        symbol: __ticker__
        period: FY
      date_key: date
      cadence_mode: interval
      min_age_days: 0
      run_days:
        - sun
      help_url: https://example.com/docs/income-statement
- domain: company
  source: fmp
  dataset: company-notes
  discriminator: ''
  ticker_scope: per_ticker
  silver_schema: silver
  silver_table: company-notes
  key_cols:
    - ticker
  row_date_col: null
  recipes:
    - plans:
        - basic
      data_source_path: fake/error
      query_vars:
        symbol: __ticker__
      date_key: date
      cadence_mode: interval
      min_age_days: 0
      run_days:
        - mon
      help_url: https://example.com/docs/company-notes
